### 日曜日

@pandax381さんのプロトコルスタック自作教材 [microps](https://github.com/pandax381/microps)。
どんなテスト環境だったか忘れていたので、まとめてみる。
基本的に tap デバイスを２つ作って、
１つはOSのプロトコルスタックを使用、
もう一つは自作のプロトコルスタック使うようにする。
たとえば、ping 応答をテストしたい場合は、以下のような構成になる：

<img src="https://i.imgur.com/rf0NP6t.png" width="700">

mircrops では[実デバイスも扱えるように設計](https://docs.google.com/presentation/d/1_fTLvWuNkJ0cpQFKQ1m-J58nAX2kCSe8DujD7RiyStA/edit?slide=id.gd3283b5d32_0_931#slide=id.gd3283b5d32_0_931)されていて、
その場合はソケットの PF_PACKET, SOCK_RAW を使い、
OS のプロトコルスタックを完全にバイパスする。

ソケットの PF_{INET,PACKET}, SOCK_{RAW,DGRAM,STREAM} の意味をメモ（参照：man 7 raw, man 7 packet）。

<img src="https://i.imgur.com/HQRHUho.png" width="700">

### 日曜日

[traceroute](https://packages.debian.org/trixie/traceroute) コマンドの仕組みを知る。
そもそも traceroute とは、最終目的地のサーバに到達するまで経由したルータのIPアドレス、台数がわかる。
通常の IP 通信だと src と dst のアドレスがヘッダに載るだけなので、
途中経路はわからない。
traceroute は以下を N=1,2,3... と繰り返す仕組み[らしい](https://ja.wikipedia.org/wiki/Traceroute)：

1. TTL を N に設定して、パケットを送信
2. 途中のルータで TTL が 0 になる
3. そのルータから ICMP エラー (Time Exceeded) が返る
4. その ICMP の送信元が IP = N 番目のルータ

ICMPパケットは IP ヘッダを含むので、ルータのIPアドレスが分かる[とのこと](https://datatracker.ietf.org/doc/html/rfc792)：

> ICMP, uses the basic support of IP as if it were a higher level protocol, however, ICMP is actually an integral part of IP, and must be implemented by every IP module.

---

mtr コマンドという ping と traceroute を合わせたようなコマンドも見つけて、楽しい：

```
                                      My traceroute  [v0.95]
blue (192.168.32.176) -> example.com (104.18.27.120)                      2026-01-04T13:07:51+0900
Keys:  Help   Display mode   Restart statistics   Order of fields   quit
                                                          Packets               Pings
 Host                                                   Loss%   Snt   Last   Avg  Best  Wrst StDev
 1. _gateway                                             0.0%     6    2.6   1.5   1.1   2.6   0.6
 2. oha-mx480-bbbas01.qtnet.ad.jp                        0.0%     6    4.6   3.8   3.1   4.6   0.6
 3. 218.40.226.53                                        0.0%     6    3.7   4.2   3.7   5.0   0.5
 4. 61.203.192.237                                       0.0%     6    3.9   4.5   3.7   7.0   1.3
 5. 61.203.193.122                                       0.0%     5  128.6  58.1  18.0 128.6  55.2
 6. 61.203.192.154                                       0.0%     5  105.4  41.1  19.0 105.4  37.2
 7. 103.22.201.95                                        0.0%     5   19.5  22.0  18.4  29.8   4.8
 8. 104.18.27.120                                        0.0%     5   58.9  30.9  18.4  58.9  18.2
```

---

[Slay the Spire](https://store.steampowered.com/app/646570/Slay_the_Spire/?l=japanese). 公式のプロモーションビデオで "Horribly addictive" とのこと。アカンやん。